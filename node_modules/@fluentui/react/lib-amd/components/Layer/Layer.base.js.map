{"version":3,"file":"Layer.base.js","sourceRoot":"../src/","sources":["components/Layer/Layer.base.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { Fabric } from '../../Fabric';\nimport { classNamesFunction, setPortalAttribute, setVirtualParent } from '../../Utilities';\nimport { registerLayer, getDefaultTarget, unregisterLayer, getLayerHost } from './Layer.notification';\nimport { useIsomorphicLayoutEffect, useMergedRefs, useWarnings } from '@fluentui/react-hooks';\nimport { useDocument } from '../../WindowProvider';\nimport type { ILayerProps, ILayerStyleProps, ILayerStyles } from './Layer.types';\n\nconst getClassNames = classNamesFunction<ILayerStyleProps, ILayerStyles>();\n\nexport const LayerBase: React.FunctionComponent<ILayerProps> = React.forwardRef<HTMLDivElement, ILayerProps>(\n  (props, ref) => {\n    const rootRef = React.useRef<HTMLSpanElement>(null);\n    const mergedRef = useMergedRefs(rootRef, ref);\n    const layerRef = React.useRef<HTMLDivElement>();\n\n    // Tracks if the layer mount events need to be raised.\n    // Required to allow the DOM to render after the layer element is added.\n    const [needRaiseLayerMount, setNeedRaiseLayerMount] = React.useState(false);\n\n    const doc = useDocument();\n\n    const {\n      eventBubblingEnabled,\n      styles,\n      theme,\n      className,\n      children,\n      hostId,\n      onLayerDidMount = () => undefined,\n      // eslint-disable-next-line deprecation/deprecation\n      onLayerMounted = () => undefined,\n      onLayerWillUnmount,\n      insertFirst,\n    } = props;\n\n    const classNames = getClassNames(styles!, {\n      theme: theme!,\n      className,\n      isNotHost: !hostId,\n    });\n\n    // Returns the user provided hostId props element, the default target selector,\n    // or undefined if document doesn't exist.\n    const getHost = (): Node | null => {\n      if (hostId) {\n        const layerHost = getLayerHost(hostId);\n\n        if (layerHost) {\n          return layerHost.rootRef.current ?? null;\n        }\n\n        return doc?.getElementById(hostId) ?? null;\n      } else {\n        const defaultHostSelector = getDefaultTarget();\n        return (defaultHostSelector ? doc?.querySelector(defaultHostSelector) : doc?.body) ?? null;\n      }\n    };\n\n    // Removes the current layer element's parentNode and runs onLayerWillUnmount prop if provided.\n    const removeLayerElement = (): void => {\n      onLayerWillUnmount?.();\n\n      const elem = layerRef.current;\n\n      // Clear ref before removing from the DOM\n      layerRef.current = undefined;\n\n      if (elem && elem.parentNode) {\n        elem.parentNode.removeChild(elem);\n      }\n    };\n\n    // If a doc or host exists, it will remove and update layer parentNodes.\n    const createLayerElement = () => {\n      const host = getHost();\n\n      if (!host) {\n        return;\n      }\n\n      // Remove and re-create any previous existing layer elements.\n      removeLayerElement();\n\n      const el = (host.ownerDocument ?? doc)?.createElement('div');\n\n      if (el) {\n        el.className = classNames.root!;\n        setPortalAttribute(el);\n        setVirtualParent(el, rootRef.current!);\n\n        insertFirst ? host.insertBefore(el, host.firstChild) : host.appendChild(el);\n        layerRef.current = el;\n        setNeedRaiseLayerMount(true);\n      }\n    };\n\n    useIsomorphicLayoutEffect(() => {\n      createLayerElement();\n      // Check if the user provided a hostId prop and register the layer with the ID.\n      if (hostId) {\n        registerLayer(hostId, createLayerElement);\n      }\n\n      return () => {\n        removeLayerElement();\n\n        if (hostId) {\n          unregisterLayer(hostId, createLayerElement);\n        }\n      };\n      // eslint-disable-next-line react-hooks/exhaustive-deps -- should run if the hostId updates.\n    }, [hostId]);\n\n    React.useEffect(() => {\n      if (layerRef.current && needRaiseLayerMount) {\n        onLayerMounted?.();\n        onLayerDidMount?.();\n        setNeedRaiseLayerMount(false);\n      }\n    }, [needRaiseLayerMount, onLayerMounted, onLayerDidMount]);\n\n    useDebugWarnings(props);\n\n    return (\n      <span className=\"ms-layer\" ref={mergedRef}>\n        {layerRef.current &&\n          ReactDOM.createPortal(\n            /* eslint-disable deprecation/deprecation */\n            <Fabric {...(!eventBubblingEnabled && getFilteredEvents())} className={classNames.content}>\n              {children}\n            </Fabric>,\n            /* eslint-enable deprecation/deprecation */\n            layerRef.current,\n          )}\n      </span>\n    );\n  },\n);\nLayerBase.displayName = 'LayerBase';\n\nlet filteredEventProps: { [key: string]: (ev: React.SyntheticEvent<HTMLElement, Event>) => void };\n\nconst onFilterEvent = (ev: React.SyntheticEvent<HTMLElement>): void => {\n  // We should just be able to check ev.bubble here and only stop events that are bubbling up. However, even though\n  // mouseenter and mouseleave do NOT bubble up, they are showing up as bubbling. Therefore we stop events based on\n  // event name rather than ev.bubble.\n  if (\n    ev.eventPhase === Event.BUBBLING_PHASE &&\n    ev.type !== 'mouseenter' &&\n    ev.type !== 'mouseleave' &&\n    ev.type !== 'touchstart' &&\n    ev.type !== 'touchend'\n  ) {\n    ev.stopPropagation();\n  }\n};\n\nfunction getFilteredEvents() {\n  if (!filteredEventProps) {\n    filteredEventProps = {} as any;\n    [\n      'onClick',\n      'onContextMenu',\n      'onDoubleClick',\n      'onDrag',\n      'onDragEnd',\n      'onDragEnter',\n      'onDragExit',\n      'onDragLeave',\n      'onDragOver',\n      'onDragStart',\n      'onDrop',\n      'onMouseDown',\n      'onMouseEnter',\n      'onMouseLeave',\n      'onMouseMove',\n      'onMouseOver',\n      'onMouseOut',\n      'onMouseUp',\n      'onTouchMove',\n      'onTouchStart',\n      'onTouchCancel',\n      'onTouchEnd',\n      'onKeyDown',\n      'onKeyPress',\n      'onKeyUp',\n      'onFocus',\n      'onBlur',\n      'onChange',\n      'onInput',\n      'onInvalid',\n      'onSubmit',\n    ].forEach(name => (filteredEventProps[name] = onFilterEvent));\n  }\n  return filteredEventProps;\n}\n\nfunction useDebugWarnings(props: ILayerProps) {\n  if (process.env.NODE_ENV !== 'production') {\n    // eslint-disable-next-line react-hooks/rules-of-hooks -- build-time conditional\n    useWarnings({\n      name: 'Layer',\n      props,\n      deprecations: { onLayerMounted: 'onLayerDidMount' },\n    });\n  }\n}\n"]}